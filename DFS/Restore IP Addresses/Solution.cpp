// LeetCode, Restore IP Addresses
// Time complexity O(n^4)
class Solution {
public:
    vector<string> restoreIpAddresses(string s) {
        vector<string> result;
        string ip;  // store the middle result
        dfs(s, 0, 0, ip, result);
        return result;
    }
    /**
     * @brief 解析字符串
     * @param[in] s 字符串，输入数据
     * @param[in] startIndex 从s的哪里开始
     * @param[in] step 当前步骤编号，从0开始编号，取值为0,1,2,3,4表示结束了
     * @param[out] intermediate 当前解析出来的中间结果
     * @param[out] result 存放所有可能的IP地址
     * @return 无
     */
    
    void dfs(string s, size_t start, size_t step, string ip, vector<string> &result) {
        if (start == s.size() && step == 4) {  // find a closed-solution
            ip.resize(ip.size() - 1);
            result.push_back(ip);
            return;
        }
        
        if (s.size() - start > (4 - step) * 3) {
            return;
        }
        if (s.size() - start < (4 - step)) {
            return;
        }
        int num = 0;
        for (size_t i = start; i < start + 3; i++) {
            num = num * 10 + (s[i] - '0');
            if (num <= 255) { // current point legal,go on the code.
                ip += s[i];
                dfs(s, i + 1, step + 1, ip + '.', result);
            }
            if (num == 0) break;  // not allow the 0-pre,but single 0
        }
    }
};